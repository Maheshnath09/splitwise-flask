<!-- templates/add_expense.html -->
{% extends "base.html" %}

{% block title %}Add Expense - Splitwise Clone{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Add an expense</h1>
    
    <form method="POST" action="{{ url_for('add_expense') }}">
        <div class="mb-6">
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <input type="text" id="description" name="description" required
                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
        </div>
        
        <div class="mb-6">
            <label for="amount" class="block text-sm font-medium text-gray-700 mb-1">Amount (â‚¹)</label>
            <input type="number" id="amount" name="amount" step="0.01" min="0.01" required
                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
        </div>
        
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Split</label>
            <div class="space-y-4">
                <div class="flex items-center">
                    <input id="you_paid" name="split_type" type="radio" value="you_paid" 
                           class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300" checked>
                    <label for="you_paid" class="ml-2 block text-sm text-gray-700">
                        You paid, split equally
                    </label>
                </div>
                <div class="flex items-center">
                    <input id="they_paid" name="split_type" type="radio" value="they_paid" 
                           class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300">
                    <label for="they_paid" class="ml-2 block text-sm text-gray-700">
                        Someone else paid
                    </label>
                </div>
            </div>
        </div>
        
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">With you and</label>
            <div class="space-y-2 max-h-60 overflow-y-auto p-2 border rounded-md">
                {% for friend in current_user.friends %}
                    <div class="flex items-center">
                        <input id="friend_{{ friend.id }}" name="friend_ids" type="checkbox" value="{{ friend.id }}"
                               class="h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded">
                        <label for="friend_{{ friend.id }}" class="ml-2 block text-sm text-gray-700">
                            {{ friend.username }}
                        </label>
                    </div>
                {% else %}
                    <p class="text-sm text-gray-500">No friends yet. <a href="{{ url_for('friends') }}" class="text-green-600 hover:underline">Add friends</a> to split expenses.</p>
                {% endfor %}
            </div>
        </div>
        
        <div class="mb-6">
            <label for="group_id" class="block text-sm font-medium text-gray-700 mb-1">Group (optional)</label>
            <select id="group_id" name="group_id" 
                   class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <option value="none">No group</option>
                {% for group in groups %}
                    <option value="{{ group.id }}">{{ group.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="flex justify-end space-x-3">
            <a href="{{ url_for('dashboard') }}" 
               class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                Cancel
            </a>
            <button type="submit" 
                   class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                Save
            </button>
        </div>
    </form>
</div>

<script>
    // Show/hide friend selection based on split type
    document.querySelectorAll('input[name="split_type"]').forEach(radio => {
        radio.addEventListener('change', function() {
            const friendCheckboxes = document.querySelectorAll('input[name="friend_ids"]');
            if (this.value === 'they_paid') {
                friendCheckboxes.forEach(checkbox => {
                    checkbox.type = 'radio';
                    checkbox.name = 'friend_ids[]';
                });
            } else {
                friendCheckboxes.forEach(checkbox => {
                    checkbox.type = 'checkbox';
                    checkbox.name = 'friend_ids[]';
                });
            }
        });
    });
</script>
{% endblock %}